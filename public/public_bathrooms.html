<html>
<head>
  <meta charset=utf-8 />
  <title>Public Bathrooms</title>

  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400i|Montserrat:500,700" rel="stylesheet">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
  <!-- City of Boston CSS -->
  <link rel="stylesheet" type="text/css" href="https://www.boston.gov/crispus/css/public.css" />
  <!-- Marker Cluster CSS-->
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.0.4/dist/MarkerCluster.Default.css">
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/leaflet.markercluster@1.0.4/dist/MarkerCluster.css">

  <style>
    .co {position: relative; z-index: 1000;}

    body { margin:0; padding:0; }

    #map { position: absolute; top:0; bottom:0; right:0; left:0; }

    .leaflet-popup {
      width: 300px;
      height: auto;
    }

    .leaflet-popup-content .title {
      font-size: 22px;
      font-family: 'Montserrat', sans-serif;
      font-weight: bold;
    }

    .leaflet-popup-content .times {
      font-size: 16px;
      font-family: 'Lora', serif;
      font-style: italic;
    }

    .leaflet-popup-content .content {
      font-size: 14px;
      font-family: 'Lora', serif;
      font-style: italic;
    }

    .leaflet-popup-content p {
      font-size: 14px;
      font-family: 'Lora', serif;
      margin: 0px;
    }

    a[href=""] {
    	color: #000000;
    	text-decoration: none;
    	cursor: default;
    }

    .queries {
      position: static;
      top: 25px;
      left: 25px;
      background: white;
      z-index: 1000;
    }

    @media screen and (min-width: 980px) {
      .queries {
        position: absolute;
        padding: .5em;
        margin-left: 20px;
        width: 500px;
      }
    }

    @media screen and (max-width: 350px) {
      td {
        display: inline-block;
      }
    }

    .query {
      padding: .5em;
      box-shadow: none;
    }

    label {
      font-size: 22px;
      font-family: "Montserrat", Arial, sans-serif;
      font-weight: bold;
    }

    .query select {
      font-family: 'Lora', serif;
      font-size: 18px;
      font-style: italic;
    }

    /* style leaflet marker clusters */
    .marker-cluster-small {
      background-color: rgba(40, 139, 228, 0.6);
    }
    .marker-cluster-small div {
      background-color: rgba(40, 139, 228, 0.6);
    }
    .marker-cluster-medium {
      background-color: rgba(40, 139, 228, 0.6);
    }
    .marker-cluster-medium div {
      background-color: rgba(40, 139, 228, 0.6);
    }
    .marker-cluster-large {
      background-color: rgba(40, 139, 228, 0.6);
    }
    .marker-cluster-large div {
      background-color: rgba(40, 139, 228, 0.6);
    }

    .marker-cluster div {
      width: 30px;
      height: 30px;
      margin-left: 5px;
      margin-top: 5px;
      text-align: center;
      border-radius: 15px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 500;
      font-size: : 12px;
      color: white;
    }

    h6 {
      font-size: 14px;
      font-family: 'Lora', serif;
      font-style: italic;
      padding: .5em;
    }

  </style>
</head>
<body>

<div id="map"></div>


<div class="co">
    <input id="collapsible" type="checkbox" class="co-f d-n" aria-hidden=true>
    <label for="collapsible" class="co-t">Filter Public Bathrooms</label>
    <div class="co-b">

      <div class="queries">
  			<div id="query1" class="query leaflet-control-button leaflet-bar">
  				<label>
  				  Day of week:
  				  <select id="day">
  				    <option value='1=1'>Any</option>
  				    <option value="day = 'Monday'">Monday</option>
  				    <option value="day = 'Tuesday'">Tuesday</option>
  				    <option value="day = 'Wednesday'">Wednesday</option>
  				    <option value="day = 'Thursday'">Thursday</option>
  				    <option value="day = 'Friday'">Friday</option>
  				    <option value="day = 'Saturday'">Saturday</option>
  				    <option value="day = 'Sunday'">Sunday</option>
  				  </select>
  				</label>
  			</div>

  			<div id="query2" class="query leaflet-bar">
        </div>

        </div>
        <table style="height:50px">
            <td><img src="./images/bathroom.svg" alt="Public Bathroom" style="width:50px"></td>
            <td><h6>Public Bathroom</h6></td>
        </table>
  		</div>

    </div>
</div>
<!-- Leaflet javascript -->
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet-src.js"></script>
<!-- Esri Leaflet -->
<script src="https://unpkg.com/esri-leaflet@2.0.8"></script>
<!-- Marker Cluster -->
<script src="https://unpkg.com/leaflet.markercluster@1.0.4/dist/leaflet.markercluster.js"></script>
<script src="https://unpkg.com/esri-leaflet-cluster@2.0.0"></script>

<script>

  // ADD FILTERS //

  // get day of week as a string
  function DayOfWeekAsString(dayIndex) {
    return ["Sunday", "Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][dayIndex];
  }

  // get current day of week and make the default selection
  var d = new Date();
  var n = d.getDay();
  var temp = DayOfWeekAsString(n);
  var day = document.getElementById('day');
  var days = ["Sunday", "Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
  day.selectedIndex = days.indexOf(temp);

  // CREATE MAP //
  var map = L.map('map', {zoomControl: false}).setView([42.318321, -71.084414], 12);

  //add zoom control to top right
  L.control.zoom({
       position:'bottomright'
  }).addTo(map);

  // find user location
  map.locate({setView: true, maxZoom: 15});

  function onLocationFound(e) {
    var radius = e.accuracy / 2;

  var user_loc = L.marker(e.latlng).addTo(map)
    .bindPopup('<p class="title">You are here.</p>').openPopup();

  var radius_circle = L.circle(e.latlng, radius, {color:'#091F2F',opacity:1,fillOpacity:.2}).addTo(map);
  }

  map.on('locationfound', onLocationFound);

  // add mapbox basemap
  L.tileLayer('https://api.mapbox.com/styles/v1/cityofboston/cj1hyqwt2001s2so0hjacals3/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiY2l0eW9mYm9zdG9uIiwiYSI6ImNqMTd1dDdqZTA1c2UyeHFzNGhrN2g0bHYifQ.SZ8J0aXwDHt4sCmZ9rQO2A').addTo(map);

  var icons = {
    Bathroom: L.icon({
      iconUrl: './images/bathroom.svg',
      iconSize: [30, 30],
    }),
  };

  var markers = L.markerClusterGroup();

  var public_bathrooms = L.esri.query({
    url: 'https://services.arcgis.com/sFnw0xNflSi8J0uh/arcgis/rest/services/public_bathrooms/FeatureServer/0'
  });

  public_bathrooms.where(day.value).run(function(error, current_bathrooms){
      markers.addLayer(L.geoJSON(current_bathrooms))
    });

  map.addLayer(markers);
  console.log(public_bathrooms);



  // var public_bathrooms = L.esri.Cluster.featureLayer({
  //   url: 'https://services.arcgis.com/sFnw0xNflSi8J0uh/arcgis/rest/services/public_bathrooms/FeatureServer/0',
  //    pointToLayer: function (geojson, latlng) {
  //     return L.marker(latlng, {
  //       icon: icons["Bathroom"]
  //     });
  //    },
  // }).addTo(map);
  //
  // public_bathrooms.bindPopup(function (layer) {
  //   return  L.Util.template('<p class="title"><b>{name}</b></p><p class="times">{address}<br>{hours}<br>Day: {day}<br><br>{neighborhood}</p><p class="content">{schedule}', layer.feature.properties);
  // });


  // day.addEventListener('change', function(){
  //   //public_bathrooms.setWhere(day.value + " AND " + market_name.value);
  //   public_bathrooms.setWhere(day.value);
  // });
  //
  // // once all data is loaded adjust display to the default selection
  // public_bathrooms.once('load', function(){
  //   //public_bathrooms.setWhere(day.value + " AND " + market_name.value);
  //   public_bathrooms.setWhere(day.value);
  // });

</script>

</body>
</html>
